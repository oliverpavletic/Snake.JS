<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Untitled Document</title>
  </head>
  <body></body>
  <script>
    // Setup
    documentSetup();
    gameSetup();

    // Create Block
    const redBlock = new Block("red", "50px", "50px", "50px");
    // Initialize speed
    const speed = 2;
    // To handle frame ids
    let frameRequest;
    // Create Food Manager
    const foodManager = new FoodManager("yellow", 1, "10px");
    // Spawn Food
    foodManager.spawnFood;  
  
    // Start movement
    move(redBlock);

    function Block(color, xInitial, yInitial, size) {
      let spriteContainer = document.getElementById("sprite-container");
      let div = document.createElement("div");

      createBlock();

      this.xPos = parseInt(xInitial.replace(/px/, ""));
      this.yPos = parseInt(yInitial.replace(/px/, ""));
      this.size = parseInt(size.replace(/px/, ""));
      this.direction = "right";

      this.moveRight = function(value) {
        this.xPos = this.xPos + value;
        div.style.left = this.xPos + value + "px";
      };

      this.moveLeft = function(value) {
        this.xPos = this.xPos - value;
        div.style.left = this.xPos - value + "px";
      };

      this.moveUp = function(value) {
        this.yPos = this.yPos - value;
        div.style.top = this.yPos - value + "px";
      };

      this.moveDown = function(value) {
        this.yPos = this.yPos + value;
        div.style.top = this.yPos + value + "px";
      };

      this.resetX = function() {
        xPos = 0;
        div.style.left = "0px";
      };

      this.resetY = function() {
        xPos = 0;
        div.style.top = "0px";
      };

      function createBlock() {
        div.style.background = "red";
        div.style.height = size;
        div.style.width = size;
        div.style.position = "absolute";
        div.style.left = xInitial;
        div.style.top = yInitial;
        spriteContainer.appendChild(div);
      }
    }

    function FoodManager(color, numPieces, size) {
      let spriteContainer = document.getElementById("sprite-container");
      const amount = numPieces;
      let pieces = [];

      function spawnFood() {
        for (var i = 0; i < amount; i++) {
          let food = new Food(color,size);
          food.scatterFood();
          pieces.push();
        }
      }

      // returns true if  'this' has same coordinates as a piece of food 
      function isTouchingFood() {

      }
    }

    function Food(color, size) {
      this.xpos = 0;
      this.ypos = 0;
      this.visible = false;

      // food has a position, a color, status
      // how will we know if the foood is touching the block? 
      // touching food should only matter when the food is visible 

      function hideFood() {

      }

      // food appears and assumes a random location (within bounds, not equal to other foods or sprite
      function scatterFood() {

      }
    }

    function documentSetup() {
      document.documentElement.style.margin = "0";
      document.documentElement.style.padding = "0";
      document.documentElement.style.height = "100%";

      document.body.style.margin = "0";
      document.body.style.padding = "0";
      document.body.style.height = "100%";
    }

    function gameSetup() {
      var gameContainer = document.createElement("div");
      gameContainer.style.background = "black";
      gameContainer.style.height = "100%";
      gameContainer.style.width = "100%";
      gameContainer.id = "game-container";

      var spriteContainer = document.createElement("div");
      spriteContainer.style.background = "blue";
      spriteContainer.style.position = "absolute";
      spriteContainer.style.height = "80%";
      spriteContainer.style.width = "80%";
      spriteContainer.style.left = "10%";
      spriteContainer.style.top = "10%";
      spriteContainer.id = "sprite-container";

      gameContainer.appendChild(spriteContainer);
      document.body.appendChild(gameContainer);
    }

    window.addEventListener("keydown", e => {
      if (!e.repeat) {
        // button is not held down such that it is automatically repeating
        switch (e.key) {
          case "ArrowUp":
          case "w":
            redBlock.direction = "up";
            break;
          case "ArrowDown":
          case "s":
            redBlock.direction = "down";
            break;
          case "ArrowLeft":
          case "a":
            redBlock.direction = "left";
            break;
          case "ArrowRight":
          case "d":
            redBlock.direction = "right";
            break;
          case " ":
            alert("GAME OVER, REFRESH");
            stop();
            break;
        }
      }
    });

    function move(block) {
      if (!(block instanceof Block)) {
        //type check
        console.log("Not of type Block");
        stop();
        return;
      } else {
        inner();
      }

      // TODO: if position is out of bounds, set to nearest bound! (screen resize issues)

      function inner() {
        var bounds = getBounds();
        var height = bounds.height;
        var width = bounds.width;

        if (block.xPos - speed <= 0) {
          block.direction = "right";
        } else if (block.xPos + speed >= width * 0.8 - block.size) {
          block.direction = "left";
        }

        if (block.yPos - speed <= 0) {
          block.direction = "down";
        } else if (block.yPos + speed >= height * 0.8 - block.size) {
          block.direction = "up";
        }

        switch (block.direction) {
          case "up":
            block.moveUp(speed);
            break;
          case "down":
            block.moveDown(speed);
            break;
          case "left":
            block.moveLeft(speed);
            break;
          case "right":
            block.moveRight(speed);
            break;
        }

        frameRequest = window.requestAnimationFrame(inner);
      }
    }

    function setSpeed(s) {
      speed = s;
    }

    function stop() {
      cancelAnimationFrame(frameRequest);
    }

    function getBounds() {
      var e = window,
        a = "inner";
      if (!("innerWidth" in window)) {
        a = "client";
        e = document.documentElement || document.body;
      }
      return { width: e[a + "Width"], height: e[a + "Height"] };
    }
  </script>
</html>
